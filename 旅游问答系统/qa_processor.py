from neo4j import GraphDatabase
import jieba
from config import NEO4J_CONFIG

# 预定义关键词（可扩展）
CITIES = ['天津', '重庆', '石家庄', '唐山', '秦皇岛', '邯郸', '邢台', '保定',
          '张家口', '承德', '沧州', '廊坊', '衡水', '辛集', '晋州', '新乐', '遵化', '迁安',
          '滦州', '武安', '南宫', '沙河', '涿州', '定州', '安国', '高碑店', '平泉', '泊头',
          '任丘', '黄骅', '河间', '霸州', '三河', '深州', '太原', '大同', '阳泉', '长治', '晋城',
          '朔州', '晋中', '运城', '忻州', '临汾', '吕梁', '古交', '高平', '怀仁', '介休', '永济',
          '河津', '原平', '侯马', '霍州', '孝义', '汾阳', '呼和浩特', '包头', '乌海', '赤峰',
          '通辽', '鄂尔多斯', '呼伦贝尔', '巴彦淖尔', '乌兰察布', '霍林郭勒', '满洲里', '牙克石',
          '扎兰屯', '额尔古纳', '根河', '丰镇', '乌兰浩特', '阿尔山', '二连浩特', '锡林浩特', '沈阳',
          '大连', '鞍山', '抚顺', '本溪', '丹东', '锦州', '营口', '阜新', '辽阳', '盘锦', '铁岭',
          '朝阳', '葫芦岛', '新民', '瓦房店', '庄河', '海城', '东港', '凤城', '凌海', '北镇',
          '盖州', '大石桥', '灯塔', '调兵山', '开原', '北票', '凌源', '兴城', '榆树', '德惠', '公主岭'
    , '蛟河', '桦甸', '舒兰', '磐石', '双辽', '梅河口', '集安', '临江', '扶余', '洮南', '大安',
          '敦化', '珲春', '龙井', '和龙'
    , '哈尔滨', '齐齐哈尔', '鸡西', '鹤岗', '双鸭山', '大庆', '伊春', '佳木斯', '七台河', '牡丹江',
          '黑河', '绥化', '尚志', '五常', '讷河', '虎林', '密山', '铁力', '同江', '富锦', '抚远',
          '绥芬河', '海林', '宁安', '穆棱', '东宁', '北安', '五大连池', '嫩江', '安达', '肇东',
          '海伦', '漠河', '南京', '无锡', '徐州', '常州', '苏州', '南通', '连云港', '淮安',
          '盐城', '扬州', '镇江', '泰州', '宿迁', '江阴', '宜兴', '新沂', '邳州', '溧阳', '常熟',
          '张家港', '昆山', '太仓', '启东', '如皋', '海安', '东台', '仪征', '高邮', '丹阳',
          '扬中', '句容', '兴化', '靖江', '泰兴', '杭州', '宁波', '温州', '嘉兴', '湖州', '绍兴',
          '金华', '衢州', '舟山', '台州', '丽水', '建德', '余姚', '慈溪', '瑞安', '乐清', '龙港',
          '海宁', '平湖', '桐乡', '诸暨', '嵊州', '兰溪', '义乌', '东阳', '永康', '江山', '温岭',
          '临海', '玉环', '龙泉']
ATTRACTIONS = {'天津之眼', '古文化街', '东方明珠', '洪崖洞', '磁器口古镇',
               '正定古城', '赵州桥', '清东陵', '南湖公园', '山海关', '北戴河', '丛台公园', '响堂山石窟', '崆山白云洞',
               '邢台大峡谷', '直隶总督署', '白洋淀', '崇礼滑雪场', '大境门', '承德避暑山庄', '普陀宗乘之庙',
               '吴桥杂技大世界', '沧州铁狮子', '天下第一城', '自然公园', '衡水湖', '宝云寺', '辛集国际皮革城',
               '润泽湖公园', '魏征公园', '周家庄农业观光园', '伏羲台', '河北美术学院', '清东陵', '汤泉宫温泉',
               '黄台山公园', '山叶口景区', '滦州古城', '研山风景区', '京娘湖', '古武当山', '南宫湖', '普彤寺',
               '北武当山', '秦王湖', '三义宫', '涿州影视城', '定州开元寺塔', '定州贡院', '药王庙', '东方药城',
               '世界门窗小镇', '紫泉河景区', '辽河源国家森林公园', '泽州园', '泊头清真寺', '三井大运河遗址', '白洋淀',
               '鄚州庙', '黄骅港', '南大港湿地', '河间府署', '光明戏院', '霸州龙泉禅寺', '中华戏曲城', '燕郊植物园',
               '三河大峡谷', '深州蜜桃观光园', '盈亿义仓', '晋祠', '天龙山石窟', '云冈石窟', '悬空寺', '娘子关',
               '翠枫山', '太行山大峡谷', '老顶山国家森林公园', '皇城相府', '王莽岭', '应县木塔', '崇福寺', '平遥古城',
               '乔家大院', '解州关帝庙', '运城盐湖', '五台山', '雁门关', '尧庙', '壶口瀑布', '北武当山', '碛口古镇',
               '金牛森林公园', '狐爷山', '炎帝陵', '羊头山石窟', '金沙滩生态旅游区', '清凉山', '绵山', '张壁古堡',
               '普救寺', '鹳雀楼', '龙门', '真武庙', '天涯山', '五峰山', '侯马晋国遗址', '彭真故居', '霍州署', '七里峪',
               '孝义孝文化园', '胜溪湖森林公园', '汾酒文化景区', '文峰塔', '大召寺', '内蒙古博物院', '五当召',
               '赛汗塔拉草原', '金沙湾', '甘德尔山', '克什克腾石阵', '乌兰布统草原', '大青沟',
               '孝庄园文化旅游区', '响沙湾', '成吉思汗陵', '呼伦贝尔大草原', '满洲里国门', '纳林湖',
               '黄河河套文化旅游区', '辉腾锡勒草原', '火山地质公园', '可汗山', '观音山', '国门景区',
               '套娃广场', '凤凰山滑雪场', '绰尔河峡谷', '吊桥公园', '秀水风景区', '额尔古纳湿地', '白桦林景区',
               '敖鲁古雅使鹿部落', '冷极村',
               '薛刚山', '金龙大王庙', '成吉思汗庙', '五一会址', '阿尔山国家森林公园', '白狼峰', '二连浩特国门',
               '恐龙地质公园', '贝子庙', '锡林郭勒草原', '沈阳故宫', '张氏帅府', '老虎滩海洋公园', '星海广场',
               '千山风景区', '玉佛苑',
               '雷锋纪念馆', '赫图阿拉城', '本溪水洞', '关门山', '鸭绿江断桥', '抗美援朝纪念馆', '辽沈战役纪念馆',
               '笔架山', '辽河老街', '山海广场', '海棠山摩崖造像', '瑞应寺', '辽阳白塔', '东京陵', '红海滩',
               '鼎翔生态旅游区', '龙首山', '银冈书院', '兴城古城', '龙湾海滨', '新民三农博览园', '辽滨塔', '仙浴湾',
               '龙王庙', '冰峪沟', '海王九岛',
               '白云山', '厝石山公园', '大鹿岛', '獐岛', '凤凰山', '大梨树生态旅游区', '翠岩山', '岩井寺', '北镇庙',
               '医巫闾山', '赤山', '青龙山', '迷镇山', '金牛山古人类遗址', '葛西河生态走廊', '燕州城遗址', '兵山广场',
               '明月禅寺', '咸州古城', '象牙山', '大黑山国家森林公园', '鸟化石国家地质公园', '热水汤温泉', '天盛号石窟',
               '兴城古城', '兴城海滨',
               '伪满皇宫博物院', '净月潭国家森林公园', '雾凇岛', '北山公园', '叶赫那拉城', '四平战役纪念馆', '龙山公园',
               '矿工墓陈列馆', '靖宇陵园', '五女峰国家森林公园', '锦江大峡谷', '长白山国际度假区', '龙华寺', '查干湖',
               '莫莫格国家级自然保护区', '向海国家级自然保护区', '花园山旅游风景区', '五棵树湿地公园', '跃进水库',
               '德惠公园', '公主岭国家农业科技园区', '拉法山国家森林公园', '红叶谷', '大庆龙凤湿地', '五营国家森林公园',
               '汤旺河林海奇石景区',
               '二十家子旅游度假区', '红叶谷', '拉法山国家森林公园', '红石国家森林公园', '白山湖', '凤凰山',
               '亮甲山水库', '黄河水库', '官马溶洞', '一马树森林公园', '郑家屯博物馆', '鸡冠山国家森林公园',
               '海龙湖景区', '高句丽王城', '五女峰国家森林公园', '四保临江战役纪念馆', '陈云旧居', '大金得胜陀颂碑',
               '扶余公园', '敖牛山风景区', '吴俊升商业大楼旧址', '嫩江湾国家湿地公园', '五间房水岛乐园',
               '帽儿山国家森林公园', '中国朝鲜族民俗园', '图们口岸',
               '图们江公园', '六鼎山文化旅游区', '正觉寺', '防川风景区', '土字牌', '龙井朝鲜族民俗博物馆',
               '琵岩山风景区', '仙景台风景区', '金达莱民俗村', '圣索菲亚大教堂', '中央大街', '扎龙自然保护区',
               '龙沙公园', '兴凯湖', '乌苏里江', '鹤岗国家森林公园', '松鹤公园', '七星峰森林公园', '北秀公园',
               '铁人王进喜纪念馆', '龙凤湿地', '五营国家森林公园', '汤旺河林海奇石景区', '水源山公园', '佳木斯沿江公园',
               '石龙山森林公园', '桃山湖', '中国雪乡', '镜泊湖', '瑷珲古城', '五大连池', '林枫故居纪念馆', '金龟山庄',
               '圣索菲亚大教堂', '哈尔滨冰雪大世界', '扎龙自然保护区', '龙沙公园', '兴凯湖', '北大荒书法艺术长廊',
               '天水湖公园', '鹤岗国家森林公园', '北秀公园', '凤林古城', '铁人王进喜纪念馆', '黑瞎子岛',
               '佳木斯沿江公园', '石龙山国家森林公园', '桃山湖', '中国雪乡', '镜泊湖', '五大连池风景区',
               '中俄民族风情园', '林枫故居纪念馆', '金龟山庄', '亚布力滑雪旅游度假区', '赵尚志纪念馆',
               '凤凰山国家森林公园', '稻花香生态旅游区', '雨亭国家城市湿地公园',
               '讷河尔站生态园', '虎头旅游风景区', '神顶峰', '兴凯湖新开流景区', '北大荒书法长廊', '桃山国际狩猎场',
               '日月峡国家森林公园', '三江口生态旅游区', '街津口赫哲族旅游度假区',
               '富锦国家湿地公园', '万亩水稻公园', '东极广场', '黑瞎子岛', '绥芬河国门景区', '大白楼（中东铁路记忆馆）',
               '中国雪乡（双峰林场)', '威虎山城影视基地', '镜泊湖风景区', '渤海国上京龙泉府遗址', '六峰湖国家森林公园',
               '红豆杉广场', '东宁要塞群遗址', '洞庭风景区', '北安博物馆', '庆华军工遗址博物馆', '五大连池风景区',
               '药泉山', '江畔公园', '墨尔根古道驿站博物馆', '东湖湿地', '安达牛文化博物馆', '肇东生态园', '八里城遗址',
               '海伦大豆产业园', '东方红水库', '北极村', '北红村', '中国最北点', '中山陵', '夫子庙-秦淮风光带',
               '鼋头渚', '灵山胜境', '云龙湖风景区', '龟山汉墓',
               '中华恐龙园', '天目湖旅游度假区', '拙政园', '平江路', '狼山风景名胜区', '濠河风景名胜区', '花果山',
               '连岛海滨度假区', '周恩来故里旅游景区', '里运河文化长廊', '中华麋鹿园', '丹顶鹤湿地生态旅游区', '瘦西湖',
               '个园', '金山寺', '西津渡古街', '凤城河风景区', '溱园湖国家湿地公', '三台山国家森林公园', '项王故里',
               '江阴黄山湖公园', '学政文化旅游区', '善卷洞', '宜兴竹海风景区', '马陵山风景名胜区', '窑湾古镇',
               '窑湾古镇', '艾山九龙风景区', '邳州银杏博览园', '天目湖旅游度假区', '南山竹海', '沙家浜·虞山尚湖旅游区',
               '方塔园', '香山风景区', '永联江南农耕文化园', '周庄古镇', '亭林园', '金仓湖公园', '沙溪古镇', '黄金海滩',
               '启东碧海银沙', '水绘园', '东方大寿星园', '江淮文化园',
               '七星湖生态园', '黄海森林公园', '西溪旅游文化景区', '捺山地质公园', '天乐湖旅游度假区', '盂城驿',
               '高邮湖', '丹阳眼镜城', '天地石刻园', '长江渔文化生态园', '园博园', '茅山风景区', '宝华山国家森林公园',
               '李中水上森林', '千垛景区（油菜花田）', '孤山风景区', '牧城公园', '黄桥古镇'
                                                                               '古银杏森林公园', '南湖旅游区', '乌镇',
               '南浔古镇', '莫干山风景区', '鲁迅故里', '沈园',
               '南湖旅游区', '乌镇', '南浔古镇', '莫干山风景区', '双龙风景名胜区', '横店影视城', '江郎山·廿八都旅游区',
               '根宫佛国文化旅游区', '普陀山风景名胜区', '朱家尖', '天台山风景名胜区', '神仙居', '云和梯田'
                                                                                                 '缙云仙都', '新安江',
               '大慈岩风景区（悬空寺）', '河姆渡遗址博物馆', '四明山国家森林公园', '杭州湾国家湿地公园', '鸣鹤古镇',
               '玉海楼', '桐溪风景区', '雁荡山风景区（北雁荡山）', '中雁荡山风景区', '龙港新城（月湖公园）', '舥艚渔港',
               '盐官观潮景区',
               '海宁中国皮革城', '东湖景区', '莫氏庄园', '濮院时尚古镇', '乌镇', '西施故里旅游区', '五泄风景区',
               '百丈飞瀑', '越剧小镇', '诸葛八卦村', '兰溪古城', '义乌国际商贸城', '佛堂古镇', '横店影视城', '卢宅',
               '方岩风景区', '永康国际会展中心（五金城）', '江郎山', '廿八都古镇', '长屿硐天', '方山·南嵩岩',
               '台州府城文化旅游区（江南长城）', '紫阳古街', '大鹿岛', '漩门湾国家湿地公园', '龙泉青瓷博物馆',
               '龙泉山景区（凤阳山）'}
FOODS = ['北京烤鸭', '冰糖葫芦', '狗不理包子', '煎饼果子', '小笼包', '生煎', '火锅', '担担面',
         '驴肉火烧', '牛肉罩饼', '蜂蜜麻糖', '万里香烧鸡', '烤大虾', '四条包子', '邯郸熏肉', '驴肉卷饼', '邢台锅贴',
         '黑家饺子', '驴肉火烧', '白运章包子', '烤全羊', '莜面窝窝', '承德驴打滚', '野味火锅', '沧州火锅鸡', '羊肠汤',
         '香河肉饼', '三河豆片', '衡水湖全鱼宴', '故城熏肉', '辛集扒鸡', '金束鹿酥糖', '晋州鸭梨', '晋州烩面',
         '新乐花生', '新乐熏肉', '遵化板栗', '东陵糕点', '迁安老酒', '建昌营馓子', '滦州花生酥糖', '滦河红鲤',
         '武安拽面', '武安小麻糖', '南宫熏菜', '南宫大锅菜', '沙河排骨', '沙河挂面', '涿州贡米', '张飞家酒', '定州焖子',
         '定州手掰肠', '安国药膳', '祁州酒', '高碑店豆腐丝', '黄桃罐头', '平泉羊汤', '改刀肉', '泊头鸭梨', '交河煎饼',
         '白洋淀全鱼宴', '任丘老豆腐', '黄骅海鲜', '黄骅冬枣', '河间驴肉火烧', '河间熏肉', '霸州素冒汤', '胜芳松花蛋',
         '三河豆丝', '燕郊烤鸭', '深州蜜桃', '深州酥糖', '刀削面', '过油肉', '大同刀削面', '羊杂割', '阳泉过油肉',
         '平定黄瓜干', '长治腊驴肉', '上党糊肘子', '晋城炒凉粉', '阳城烧肝', '朔州羊杂', '右玉月饼', '平遥牛肉',
         '太谷饼', '闻喜煮饼', '运城羊肉泡馍', '忻州瓦酥', '定襄蒸肉', '临汾牛肉丸子面', '吴家熏肉', '柳林碗托',
         '吕梁红枣', '古交油面儿', '古交炖羊肉', '高平十大碗', '高平烧豆腐', '怀仁羊杂', '怀仁糖干炉', '介休担担面',
         '贯馅糖', '永济牛肉饺子', '永济扯面', '河津泡泡油糕', '河津黄河鲤鱼', '原平锅盔', '原平熏鸡', '侯马臊子面',
         '侯马羊肉锅', '霍州年馍', '霍州碗坨', '孝义火烧', '孝义豆腐脑', '汾阳杏花村汾酒', '汾阳碗秃', '手把肉', '奶茶',
         '包头烤羊腿', '莜面',
         '乌海葡萄', '黄河鲤鱼',
         '赤峰对夹', '手把肉', '通辽牛肉干', '炒米', '鄂尔多斯手把肉', '奶酪', '烤全羊', '奶茶', '河套硬四盘',
         '巴彦淖尔华莱士瓜', '乌兰察布奶酪', '手把肉', '霍林郭勒烤羊排', '奶豆腐',
         '俄式西餐', '烤羊腿', '牙克石烤冷面', '野生蘑菇', '扎兰屯沙果', '烤羊腿', '列巴', '手把肉', '鹿肉干', '蓝莓酱',
         '丰镇月饼', '丰镇熏鸡', '乌兰浩特烤羊腿',
         '炒米奶茶', '阿尔山野生菌菇', '冷水鱼', '蒙古馅饼', '手把肉', '手把肉', '奶豆腐', '老边饺子', '熏肉大饼',
         '烤鱿鱼', '海鲜焖子', '南果梨', '鞍山肉枣', '抚顺麻辣拌', '豆面卷子',
         '小市羊汤', '长宽猪蹄', '丹东黄蚬子', '韩式烤肉', '锦州烧烤', '北镇猪蹄', '营口海鲜', '营口大酱', '阜新熏兔',
         '喇嘛糕', '塔糖', '老杨头烧鸡', '盘锦河蟹', '大米', '铁岭火勺', '李记坛肉', '海鲜', '虹螺岘干豆腐', '新民血肠',
         '梁山西瓜', '瓦房店苹果',
         '海鲜', '庄河蓝莓', '庄河海鲜', '海城馅饼', '牛庄特产', '东港草莓', '海鲜',
         '凤城老窖', '满族饽饽', '凌海海鲜', '苹果', '北镇猪蹄', '鸭梨', '盖州苹果', '海鲜', '大石桥炖鱼', '南果梨',
         '灯塔大米', '皮冻', '调兵山熏肉大饼', '煤矿工人盒饭', '开原大蒜', '火勺', '北票羊汤', '小米',
         '凌源百合', '拨面', '兴城全羊宴', '海鲜', '锅包肉', '长春酱肉', '白肉血肠', '庆岭活鱼', '李连贵熏肉大饼',
         '伊通烧鸽子',
         '辽源鹿肉', '关东蒸饺', '通化葡萄酒', '高丽火盆', '林蛙油', '野山菌宴', '手把肉', '全鱼宴', '草原羊肉',
         '向海鱼宴', '榆树大米', '干豆腐', '德惠肉鸡',
         '德惠小町大米', '公主岭大米', '玉米宴', '蛟河黑木耳', '松花湖鱼宴', '桦甸林蛙', '松子', '舒兰大米', '粘豆包',
         '磐石食用菌', '山野菜', '双辽花生', '草原牛羊肉', '梅河大米', '梅河口冷面', '集安边条参', '鸭绿江鱼宴',
         '临江狗肉', '鸭绿江鲤鱼', '扶余花生', '三青山粉条', '洮南香酒', '黑水西瓜', '大安烤鸽', '嫩江鱼宴', '延吉冷面',
         '石锅拌饭', '江米鸡', '打糕'
                               '集安边条参', '鸭绿江鱼宴', '敦化小土豆', '朝鲜族泡菜', '珲春帝王蟹', '俄罗斯大列巴',
         '龙井苹果梨', '米肠', '明太鱼', '辣白菜', '哈尔滨红肠', '锅包肉', '齐齐哈尔烤肉', '北大仓酒', '鸡西冷面',
         '辣菜', '鹤岗小串', '野生菌菇', '双鸭山冷水鱼', '东北黑蜂蜂蜜', '大庆坑烤', '全鱼宴', '蓝莓', '松子',
         '佳木斯拌面', '鲟鳇鱼', '七台河烧烤', '山野菜', '朝鲜族美食', '镜泊湖鱼宴', '俄罗斯美食', '冷水鱼', '绥化大米',
         '东北杀猪菜', '锅包肉', '马迭尔冰棍', '齐齐哈尔烤肉', '铁锅炖', '鸡西冷面', '辣菜', '炖江鱼', '鹤岗小串',
         '杀猪菜',
         '双鸭山冷面', '全鱼宴', '大庆坑烤', '蓝莓果酒', '森林宴', '赫哲族塔拉哈', '佳木斯拌面', '七台河烧烤', '酸菜汤',
         '镜泊湖鱼宴', '朝鲜族大冷面', '俄式西餐', '冷水鱼宴', '绥化烤冷面', '农家杀猪菜', '山野菜', '农家一锅出',
         '五常大米饭', '大米宴', '镜泊湖红尾鱼', '宁安火山岩大米', '穆棱大豆宴', '林区小炒', '富硒大豆宴', '黑木耳刺身',
         '盐水鸭', '鸭血粉丝汤', '无锡酱排骨',
         '讷河马铃薯宴', '江鱼宴', '乌苏里江鱼宴', '野生蜂蜜', '兴凯湖大白鱼宴', '烤冷面', '林区山野菜', '松子',
         '赫哲族杀生鱼', '塔拉哈', '富锦大米饭', '铁锅炖大鹅', '鲟鳇鱼子酱', '抚远全鱼宴', '俄式烤肉', '格瓦斯',
         '林区八大碗', '野生猴头菇', '东北酱骨头',
         '东宁黑木耳', '俄式风味肠', '北安烤冷面', '矿泉豆腐', '矿泉鱼', '全豆宴', '江鱼', '炭火烤肉', '安达奶制品',
         '肇东烤饼', '杀猪菜', '冷水鱼宴', '蓝莓制品', '天目湖砂锅鱼头', '加蟹小笼包', '海鲜烧烤', '豆丹',
         '小笼包', '地锅鸡', '饣它汤', '松鼠鳜鱼', '阳澄湖大闸蟹', '南通文蛤', '缸片饼', '软兜长鱼', '平桥豆腐',
         '东台鱼汤面', '烩土膘',
         '扬州炒饭', '蟹黄汤包', '镇江锅盖面', '镇江肴肉', '泰州早茶', '溱湖八鲜', '黄狗猪头肉', '车轮饼', '江阴河豚',
         '马蹄酥', '宜兴乌米饭', '横山鱼头', '新沂捆香蹄', '邳州银杏', '邳州辣汤', '天目湖砂锅鱼头', '乌米饭', '叫化鸡',
         '蕈油面', '长江三鲜', '张家港拖炉饼', '奥灶面', '万三蹄', '太仓肉松', '长江江鲜', '启东海鲜', '启东面饼', '',
         '窑湾船菜', '如皋董糖', '如皋火腿', '麻虾酱', '河豚鱼', '陈皮酒', '东台鱼汤面', '仪征紫菜', '大仪风鹅',
         '高邮咸鸭蛋', '高邮湖大闸蟹', '丹阳大麦粥', '延陵鸭饺', '河豚', '刀鱼', '茅山老鹅', '丁庄葡萄', '兴化大闸蟹',
         '沙沟鱼圆', '靖江蟹黄汤包', '长江江鲜', '黄桥烧饼', '银杏（白果）', '嘉兴粽子', '南湖菱', '湖州大馄饨',
         '丁莲芳千张包', '绍兴臭豆腐', '绍兴黄酒', '嘉兴粽子', '南湖菱', '湖州大馄饨', '丁莲芳千张包', '绍兴臭豆腐',
         '绍兴黄酒', '金华火腿', '金华酥饼', '三头一掌', '衢州烤饼', '舟山海鲜', '海鲜面', '台州海鲜', '食饼筒',
         '缙云烧饼', '安仁鱼头', '建德豆腐包',
         '严州干菜鸭', '余姚杨梅', '梁弄大糕', '慈溪杨梅', '三北豆酥糖', '瑞安扎羊', '莘塍五香干', '龙港海鲜',
         '乐清泥蚶', '清江三鲜面', '钱库猪脏粉', '海宁缸肉', '京粉', '平湖糟蛋', '杜瓜子'
                                                                                 '桐乡煲', '阿能面',
         '西施团圆饼（西施舌）', '草塔羊肉', '嵊州小笼包', '嵊州炒年糕', '兰溪牛肉面', '游埠早茶', '义乌红糖', '东河肉饼',
         '东阳沃面', '东阳土鸡煲', '永康肉麦饼', '永康小麦饼',
         '江山碗窑水库鱼', '江山米糕', '温岭嵌糕', '山粉糊', '蛋清羊尾', '麦虾', '玉环文旦（柚）', '鱼皮馄饨', '安仁鱼头',
         '龙泉笋']
ENTITY_TYPES = {'景点': 'Attraction', '美食': 'Food', '住宿': 'Accommodation', '交通': 'Transportation'}


class TourismQAProcessor:
    def __init__(self, uri, user, password):
        self.driver = GraphDatabase.driver(uri, auth=(user, password))

    def close(self):
        self.driver.close()

    def extract_keywords(self, question):
        """提取问题中的城市、景点、实体类型"""
        keywords = {'city': None, 'attraction': None, 'entity_type': None, 'food': None}
        FOODS = ['北京烤鸭', '小笼包', '合肥小龙虾', ...]  # 保持不变

        # 1. 优先匹配最长景点名（解决短名称干扰）
        # 按景点名长度倒序排序，确保长名称优先匹配
        sorted_attractions = sorted(ATTRACTIONS, key=lambda x: len(x), reverse=True)
        for attr in sorted_attractions:
            if attr in question:
                keywords['attraction'] = attr
                # 从问题中移除已识别的景点名，避免被拆分为城市
                question = question.replace(attr, '')
                break

        # 2. 重新分词（移除景点名后）
        words = jieba.lcut(question)

        # 3. 匹配城市（此时问题中已无景点名，避免干扰）
        for word in words:
            if not keywords['city'] and word in CITIES:
                keywords['city'] = word

        # 4. 匹配美食和实体类型
        for word in words:
            if not keywords['food'] and word in FOODS:
                keywords['food'] = word
            if word in ENTITY_TYPES:
                keywords['entity_type'] = word

        return keywords
    def recognize_intent(self, keywords, question):
        """识别用户意图（如：查询城市景点、景点附近美食）"""
        c, a, t = keywords['city'], keywords['attraction'], keywords['entity_type']
        question_cut = jieba.lcut(question)
        has_near = any(word in ['附近', '周边', '旁边'] for word in question_cut)
        has_food_related = any(word in ['美食', '吃', '小吃', '餐厅'] for word in question_cut)

        if keywords.get('food') and (any(word in ['描述', '介绍'] for word in question_cut)):
            return 'query_food_description'
        elif a and has_near and has_food_related:
            return 'query_attraction_near_foods'
        elif c and t == '景点':
            return 'query_city_attractions'
        elif c and (any(word in ['描述', '介绍', '简介'] for word in question_cut)):
            return 'query_city_description'
        elif a and (any(word in ['描述', '介绍', '简介'] for word in question_cut)):
            return 'query_attraction_description'
        elif t == '美食' and keywords.get('food') and (any(word in ['描述', '介绍'] for word in question_cut)):
            return 'query_food_description'
        elif a and not t:
            return 'query_attraction_info'
        elif c and t == '交通':
            return 'query_city_transportation'
        elif a and t == '住宿':
            return 'query_attraction_near_accommodations'
        else:
            return 'unknown'

    def generate_cypher(self, intent, keywords):
        """根据意图和关键词生成Cypher查询"""
        c, a, t, food = keywords['city'], keywords['attraction'], keywords['entity_type'], keywords['food']

        if intent == 'query_city_description':
            return f"""
                MATCH (c:City {{name: '{c}'}})
                RETURN c.name AS 城市名称, c.description AS 描述
            """

        elif intent == 'query_food_description':
            return f"""
                MATCH (f:Food {{name: '{food}'}})
                RETURN f.name AS 美食名称, f.description AS 描述
            """

        elif intent == 'query_city_attractions':

            return f"""

                MATCH (c:City {{name: '{c}'}})<-[:LOCATED_IN]-(a:Attraction)

                RETURN c.name AS 城市, a.name AS 景点名称, a.type AS 类型, a.rating AS 评分

            """

        elif intent == 'query_city_transportation':
            return f"""
                MATCH (c:City {{name: '{c}'}})-[:HAS_TRANSPORTATION]->(t:Transportation)
                RETURN c.name AS 城市, t.name AS 交通方式, t.type AS 类型, t.route AS 路线, t.price AS 价格
            """

        elif intent == 'query_attraction_near_accommodations':
            return f"""
                MATCH (a:Attraction {{name: '{a}'}})-[r:NEAR_ACCOMMODATION]->(ac:Accommodation)
                RETURN a.name AS 景点名称, ac.name AS 住宿名称, ac.type AS 类型, ac.price_range AS 价格区间, r.distance AS 距离
            """

        elif intent == 'query_attraction_near_foods':
            return f"""
                MATCH (a:Attraction {{name: '{a}'}})-[r:NEAR_FOOD]->(f:Food)
                RETURN a.name AS 景点名称, f.name AS 美食名称, f.price_range AS 价格区间, r.distance AS 距离
            """

        elif intent == 'query_attraction_description' or intent == 'query_attraction_info':
            return f"""
                MATCH (a:Attraction {{name: '{a}'}})
                RETURN a.name AS 名称, a.type AS 类型, a.city AS 城市, a.open_time AS 开放时间, a.description AS 描述
            """

        else:
            return ""

    def execute_cypher(self, cypher):
        """执行Cypher查询"""
        with self.driver.session() as session:
            return [record.data() for record in session.run(cypher)]

    def format_answer(self, intent, results):
        if not results:
            return "抱歉，未找到相关信息~"
        answer = ""
        if intent == 'query_city_description':
            res = results[0]
            return f"{res['城市名称']}的介绍：{res['描述']}"
        elif intent == 'query_food_description':
            res = results[0]
            return f"{res['美食名称']}的描述：{res['描述']}"
        elif intent == 'query_city_attractions':
            # 城市景点的格式化（已正常工作）
            city_name = results[0]['城市']
            answer += f"{city_name}的景点推荐：\n"
            for idx, res in enumerate(results, 1):
                answer += f"{idx}. {res['景点名称']}（类型：{res['类型']}，评分：{res['评分']}）\n"
        elif intent == 'query_city_transportation':
            city_name = results[0]['城市']  # 需在Cypher中补充返回城市名
            answer += f"{city_name}的交通方式：\n"
            for idx, res in enumerate(results, 1):
                answer += f"{idx}. {res['交通方式']}（类型：{res['类型']}，路线：{res['路线']}，价格：{res['价格']}）\n"
        elif intent == 'query_attraction_near_accommodations':
            attraction_name = results[0]['景点名称']
            answer += f"{attraction_name}附近的住宿推荐：\n"
            for idx, res in enumerate(results, 1):
                answer += f"{idx}. {res['住宿名称']}（类型：{res['类型']}，价格：{res['价格区间']}，距离：{res['距离']}）\n"
        elif intent == 'query_attraction_near_foods':
            # 新增：景点附近美食的格式化
            attraction_name = results[0].get('景点名称')  # 从结果中获取景点名（如果Cypher返回了的话）
            if attraction_name:
                answer += f"{attraction_name}附近的美食推荐：\n"
            else:
                answer += "附近的美食推荐：\n"
            for idx, res in enumerate(results, 1):
                answer += f"{idx}. {res['美食名称']}（价格区间：{res['价格区间']}，距离：{res['距离']}）\n"
        elif intent in ['query_attraction_description', 'query_attraction_info']:
            # 统一处理景点描述和基本信息
            res = results[0]
            answer += f"{res['名称']}的基本信息：\n"
            answer += f"- 类型：{res['类型']}\n"
            answer += f"- 所在城市：{res['城市']}\n"
            answer += f"- 开放时间：{res['开放时间']}\n"
            if '描述' in res and res['描述']:
                answer += f"- 简介：{res['描述']}\n"
        return answer.strip()

    def process_question(self, question):
        """完整处理流程"""
        keywords = self.extract_keywords(question)
        print("提取的关键词：", keywords)  # 打印关键词
        intent = self.recognize_intent(keywords, question)
        print("识别的意图：", intent)  # 打印意图
        if intent == 'unknown':
            return "无法理解您的问题！可尝试：北京有什么景点？故宫附近有什么美食？"
        cypher = self.generate_cypher(intent, keywords)
        results = self.execute_cypher(cypher)
        print("查询结果：", results)  # 调试用
        return self.format_answer(intent, results)


# 测试代码
if __name__ == "__main__":
    qa = TourismQAProcessor(**NEO4J_CONFIG)
    print(qa.process_question("三河古镇附近有什么美食"))
    # 可添加更多测试案例
    # print(qa.process_question("五店市传统街区附近有什么美食？"))
    qa.close()